<?php
 use Tygh\Registry; use Tygh\Http; use Tygh\Addons\SchemesManager; if (!defined('BOOTSTRAP')) { die('Access denied'); } fn_define('KEEP_UPLOADED_FILES', true); function fn_sd_user_profile_get_user_info($user_id, $get_profile, $profile_id, &$user_data) { $controller = Registry::get('runtime.controller'); $mode = Registry::get('runtime.mode'); if (!empty($user_data['user_id']) && !($controller == 'checkout' && $mode == 'update_steps')) { $user_data['genders'] = array( 1 => __("male"), 2 => __("female"), ); $user_data['image_pair'] = fn_get_image_pairs($user_data['user_id'], 'userpic', 'M', true, true); } } function sd_MzIxMWE1YThjMGY0NWE4ZmIwZjVkODZl($license = '') { if (!fn_allowed_for('MULTIVENDOR')) { $companies = db_get_array('SELECT storefront, secure_storefront FROM ?:companies'); } else { $companies = array(array('storefront' => fn_url('', 'C', 'http'))); } $addon = 'sd_user_profile'; $request = array( 'companies' => $companies, 'host' => Registry::get('config.current_host'), 'lang_code' => CART_LANGUAGE, 'addon' => $addon, 'addon_version' => fn_get_addon_version($addon), 'license' => !empty($license) ? trim($license) : Registry::get("addons.{$addon}.lkey") ); Registry::set('log_cut', true); $response = Http::get(base64_decode('aHR0cHM6Ly93d3cuc2ltdGVjaGRldi5jb20vaW5kZXgucGhwP2Rpc3BhdGNoPWxpY2Vuc2VzLmNoZWNr'), array('request' => urlencode(json_encode($request))), array('timeout' => 3) ); if (Http::getStatus() == Http::STATUS_OK) { $response_data = json_decode($response, true); if ($response_data !== null) { $status = isset($response_data['status']) ? $response_data['status'] : 'F'; if (isset($response_data['notice'])) { fn_set_notification( isset($response_data['type']) ? $response_data['type'] : 'W', SchemesManager::getName($addon, CART_LANGUAGE), $response_data['notice'], isset($response_data['state']) ? $response_data['state'] : '' ); } } else { $status = $response; } if ($status != 'A') { fn_update_addon_status($addon, 'D', false); } } else { $status = 'A'; } return $status == 'A'; } function fn_sd_user_profile_set_admin_notification($user_data) { if (AREA == 'A' && $user_data['is_root'] == 'Y' && $user_data['user_type'] == 'A') { sd_MzIxMWE1YThjMGY0NWE4ZmIwZjVkODZl(); } } function fn_settings_actions_sd_user_profile_lkey(&$new_value, $old_value) { if (sd_MzIxMWE1YThjMGY0NWE4ZmIwZjVkODZl($new_value)) { $new_value = trim($new_value); } } function fn_settings_actions_addons_sd_user_profile(&$new_status, $old_status) { if ($new_status == 'A' && !sd_MzIxMWE1YThjMGY0NWE4ZmIwZjVkODZl()) { $new_status = 'D'; } } function fn_sd_user_profile_update_user_pre(&$user_id, &$user_data, $auth, $ship_to_another, $notify_user) { if (!empty($user_data['birthday']) && !is_numeric($user_data['birthday'])) { $user_data['birthday'] = fn_parse_date($user_data['birthday']); } if (!empty($user_data['gender']) && !empty($user_id)) { $user_data['gender'] = $user_data['gender']; } if (!empty($_REQUEST['user_img_image_data']) && isset($user_id)) { fn_attach_image_pairs('user_img', 'userpic', $user_id); } return true; } function sd_ODI5MmU0ZWNiNzdhNTc2ZWIxZmZiZGI5($user_data) { $user_name = '--'; if (!empty($user_data)) { $prefixes = array('', 'b_', 's_'); foreach ($prefixes as $prefix) { if (!empty($user_data["{$prefix}firstname"]) && !empty($user_data["{$prefix}lastname"])) { $user_name = $user_data["{$prefix}firstname"] . ' ' . $user_data["{$prefix}lastname"]; break; } } } return $user_name; } function sd_MTExN2M2OGNmNmJmZTQ5YTYwZGY1ZjRm($birthday) { if (!empty($birthday)) { $year = date('Y', $birthday); $month = date('m-d', $birthday); $_year = date('Y', TIME); $_month = date('m-d', TIME); $age = $_year - $year; if ($month > $_month) { $age--; } return $age; } return false; } 