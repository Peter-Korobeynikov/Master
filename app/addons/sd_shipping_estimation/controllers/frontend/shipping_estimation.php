<?php
 use Tygh\Registry; if (!defined('BOOTSTRAP')) { die('Access denied'); } if ($_SERVER['REQUEST_METHOD'] == 'POST') { if ($mode == 'should_prevent_request') { $should_prevent_request = sd_ZWQwYmRjMmY2ZmYwY2ZmMzNjNjc5M2Q2(); die(json_encode(array('shouldPreventRequest' => $should_prevent_request))); } else if ($mode == 'get_shipping_methods_list') { if (empty(Tygh::$app['session']['cart'])) { fn_clear_cart(Tygh::$app['session']['cart']); } $params = $_REQUEST; $params['auth'] = Tygh::$app['session']['auth']; $hide_change_location = Tygh::$app['session']['auth']['user_id'] != 0; $location_data = sd_YTA5Y2EyYzI5NzYyMDEzZDZlNWUyNjQz($params); $shipping_methods_data = sd_YzBmMTFkNzU2ZDQ4YzQzNWNhZjUzYTIz($params['product_id'], $params['auth']['user_id'], $location_data['city']); if (empty($shipping_methods_data['shipping_methods'])) { $shipping_methods_data = sd_OGE1YzEwNWRkMmM4N2NjN2Y2ODZhYmM5($params['product_id'], $params['auth']); } if (Registry::get('addons.sd_shipping_estimation.save_min_shipping') == 'Y' && !empty($params['product_id']) && !empty($shipping_methods_data['min_shipping_method']) ) { $cart = & Tygh::$app['session']['cart']; $min_shipping_method = reset($shipping_methods_data['min_shipping_method']); $group_key = sd_YmZiY2QxNTA4NzJiOTQzMDEzODAxYjMy($cart, $params['product_id']); if ($group_key >= 0) { $cart['chosen_shipping'][$group_key] = $min_shipping_method['shipping_id']; $cart['recalculate'] = $cart['calculate_shipping'] = true; $cart['user_data'] = sd_MjAxNjg3N2Q2ZjEyNDgwZjcyMTQ4ODVj(); } } Tygh::$app['view']->assign(array( 'block_id' => $params['block_id'], 'block_type' => $params['block_type'], 'shipping_methods_list' => $shipping_methods_data['shipping_methods'], 'min_shipping_method' => $shipping_methods_data['min_shipping_method'], 'hide_change_location' => $hide_change_location, 'resourse' => $location_data['resourse'], 'location' => $location_data['location'], 'location_id' => $location_data['location_id'], 'is_ajax' => true )); Tygh::$app['view']->display('addons/sd_shipping_estimation/views/shipping_estimation/shipping_methods_list.tpl'); exit(); } return; } 