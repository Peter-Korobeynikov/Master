<?php
 if (!defined('BOOTSTRAP')) { die('Access denied'); } use Tygh\Registry; use Tygh\Http; use Tygh\BlockManager\Block; use Tygh\Addons\SchemesManager; function sd_ZDhiOGVlNWQ0MjI3NzcyMDFiMWU5ZGMx() { $lang = DESCR_SL; if (fn_allowed_for('MULTIVENDOR')) { $companies_id = array(0); } else { $companies_id = db_get_fields('SELECT company_id FROM ?:companies'); } $banner_ids = db_get_fields('SELECT b.banner_id FROM ?:banners AS b
                LEFT JOIN ?:banner_descriptions AS d ON d.banner_id = b.banner_id
                WHERE d.lang_code = ?s AND d.banner LIKE ?l
                AND b.type = ?s', $lang, '%SD: demo%', 'T'); if (empty($banner_ids)) { $banner_names = array( 'wide_1' => 'SD: demo banner - camera', 'wide_2' => 'SD: demo banner - holidays', 'wide_3' => 'SD: demo banner - books', 'wide_4' => 'SD: demo banner - new arrivals' ); foreach ($companies_id as $company_id) { foreach ($banner_names as $banner_name => $banner_title) { $file_path = dirname(__FILE__) . '/demo/' . $banner_name . '.tpl'; if (file_exists($file_path) && is_readable($file_path)) { $content = file_get_contents($file_path); $wide_banner_data = array( 'banner' => $banner_title, 'position' => 0, 'type' => 'T', 'description' => $content, 'target' => 'T', 'url' => '', 'timestamp' => TIME, 'status' => 'A', 'company_id' => $company_id ); $banner_id = fn_banners_update_banner($wide_banner_data, '', DESCR_SL); if (fn_allowed_for('ULTIMATE') && (!empty($banner_id))) { db_query('INSERT INTO ?:ult_objects_sharing (share_object_id, share_object_type, share_company_id) VALUES (?i, ?s, ?i)', $banner_id, 'banners', $company_id); } } } } } $banner_ids = db_get_fields('SELECT b.banner_id FROM ?:banners AS b
            LEFT JOIN ?:banner_descriptions AS d ON d.banner_id = b.banner_id
            WHERE d.lang_code = ?s AND d.banner LIKE ?l
            AND b.type = ?s', $lang, '%SD: demo%', 'T'); $block_id = db_get_field('SELECT b.block_id FROM ?:bm_blocks AS b
            LEFT JOIN ?:bm_blocks_descriptions AS d ON d.block_id = b.block_id
            WHERE d.lang_code = ?s AND d.name LIKE ?l
            AND b.type = ?s AND b.properties LIKE ?l', $lang, '%SD: Full-width demo%', 'sd_wide_banners', '%addons/sd_wide_banner%'); if (!empty($banner_ids) && empty($block_id)) { $banner_ids_imp = implode(',', $banner_ids); $demo_data = array( 'demo' => array( 'description' => array( 'name' => 'SD: Full-width demo banners', 'lang_code' => DESCR_SL, ), 'demo_block' => array( 'type' => 'sd_wide_banners', 'block_id' => 0, 'content_data' => array( 'snapping_id' => '', 'lang_code' => DESCR_SL, 'content' => array( 'items' => array( 'filling' => 'manually', 'item_ids' => $banner_ids_imp, ), ), ), 'apply_to_all_langs' => 'Y', 'description' => array( 'name' => 'SD: Full-width demo banners', 'lang_code' => DESCR_SL, ), 'properties' => array( 'template' => 'addons/sd_wide_banner/blocks/carousel.tpl', 'navigation' => 'D', 'delay' => '15' ), 'content' => array( 'items' => array( 'filling' => 'manually', 'item_ids' => $banner_ids_imp, ), ) ) ) ); foreach ($companies_id as $company_id) { foreach ($demo_data as $demo) { Block::instance($company_id)->update($demo['demo_block'], $demo['description']); } } } } function sd_Zjk2NDUyODcyYWFjZmI4YmEyNWJhMTQy($license = '') { if (!fn_allowed_for('MULTIVENDOR')) { $companies = db_get_array('SELECT storefront, secure_storefront FROM ?:companies'); } else { $companies = array(array('storefront' => fn_url('', 'C', 'http'))); } $addon = 'sd_wide_banner'; $request = array( 'companies' => $companies, 'host' => Registry::get('config.current_host'), 'lang_code' => CART_LANGUAGE, 'addon' => $addon, 'addon_version' => fn_get_addon_version($addon), 'license' => !empty($license) ? trim($license) : Registry::get("addons.{$addon}.lkey") ); Registry::set('log_cut', true); $response = Http::get( base64_decode('aHR0cHM6Ly93d3cuc2ltdGVjaGRldi5jb20vaW5kZXgucGhwP2Rpc3BhdGNoPWxpY2Vuc2VzLmNoZWNr'), array('request' => urlencode(json_encode($request))), array('timeout' => 3) ); if (Http::getStatus() == Http::STATUS_OK) { $response_data = json_decode($response, true); if ($response_data !== null) { $status = isset($response_data['status']) ? $response_data['status'] : 'F'; if (isset($response_data['notice'])) { fn_set_notification( isset($response_data['type']) ? $response_data['type'] : 'W', SchemesManager::getName($addon, CART_LANGUAGE), $response_data['notice'], isset($response_data['state']) ? $response_data['state'] : '' ); } } else { $status = $response; } if ($status != 'A') { fn_update_addon_status($addon, 'D', false); } } else { $status = 'A'; } return $status == 'A'; } function fn_settings_actions_addons_sd_wide_banner_lkey(&$new_value, $old_value) { if (sd_Zjk2NDUyODcyYWFjZmI4YmEyNWJhMTQy($new_value)) { $new_value = trim($new_value); } } function fn_settings_actions_addons_sd_wide_banner(&$new_status, $old_status) { if ($new_status == 'A' && !sd_Zjk2NDUyODcyYWFjZmI4YmEyNWJhMTQy()) { $new_status = 'D'; } } function fn_sd_wide_banner_set_admin_notification($user_data) { if (AREA == 'A' && $user_data['is_root'] == 'Y' && $user_data['user_type'] == 'A') { sd_Zjk2NDUyODcyYWFjZmI4YmEyNWJhMTQy(); } } function sd_NzcyZjQ1MmQ1MjA1ODVmNzBiYTYzN2Rm() { $lang = DESCR_SL; $block_id = db_get_field('SELECT b.block_id FROM ?:bm_blocks AS b
                LEFT JOIN ?:bm_blocks_descriptions AS d ON d.block_id = b.block_id
                WHERE d.lang_code = ?s AND d.name LIKE ?l
                AND b.type = ?s AND b.properties LIKE ?l', $lang, '%SD: Full-width demo%', 'sd_wide_banners', '%addons/sd_wide_banner%'); if (!empty($block_id)) { Block::instance()->remove($block_id); } } function fn_sd_wide_banner_get_banner_data($banner_id, $lang_code, &$fields, $joins, $condition) { array_push($fields, '?:banners.button_color', '?:banners.font_color', '?:banner_descriptions.banner_title', '?:banner_descriptions.banner_subtitle', '?:banner_descriptions.button_text'); } function fn_sd_wide_banner_get_banners($params, $condition, $sorting, $limit, $lang_code, &$fields) { array_push($fields, '?:banners.button_color', '?:banners.font_color', '?:banner_descriptions.banner_title', '?:banner_descriptions.banner_subtitle', '?:banner_descriptions.button_text'); } 